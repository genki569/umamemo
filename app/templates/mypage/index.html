{% extends "base.html" %}

{% block content %}
<div class="dashboard-container mypage-container">
    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ -->
    <div class="main-visual mypage-header" data-aos="fade-down">
        <div class="profile-banner">
            <div class="profile-info">
                <div class="profile-image-wrapper mypage-avatar">
                    {% if current_user.profile_image %}
                        <img src="{{ current_user.profile_image }}" alt="„Éó„É≠„Éï„Ç£„Éº„É´" class="profile-image">
                    {% else %}
                        <div class="profile-image-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="profile-text mypage-user-info">
                    <h1 class="mypage-username">{{ current_user.username }}</h1>
                    {% if current_user.is_premium %}
                        <div class="premium-badge">
                            <i class="fas fa-crown"></i> Premium Member
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„Çπ -->
    <div class="quick-stats mypage-stats" data-aos="fade-up">
        <div class="stat-card points mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.point_balance }}</h3>
                <p>„Éù„Ç§„É≥„Éà</p>
            </div>
        </div>
        <div class="stat-card reviews mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.reviews.count() }}</h3>
                <p>„É¨„Éì„É•„Éº</p>
            </div>
        </div>
        <div class="stat-card favorites mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.favorite_horses.count() }}</h3>
                <p>„ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</p>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="dashboard-grid">
        <!-- ÈÄöÁü•„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="dashboard-card notifications-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="50">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-bell"></i> ÈÄöÁü•</h3>
                <a href="{{ url_for('view_all_notifications') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                <div class="notification-list mypage-list" id="dashboard-notifications">
                    {% if notifications %}
                        {% for notification in notifications[:5] %}
                            <div class="notification-item mypage-list-item {% if not notification.read %}unread{% endif %}"
                                 data-id="{{ notification.id }}">
                                <div class="notification-icon mypage-list-icon">
                                    <i class="fas {{ notification.icon_class }}"></i>
                                </div>
                                <div class="notification-content mypage-list-content">
                                    <p class="notification-text mypage-list-title">{{ notification.message }}</p>
                                    <span class="notification-time mypage-list-subtitle">{{ notification.created_at|timeago }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content mypage-empty">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº -->
        <div class="dashboard-card reviews-card mypage-card mypage-section">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-pen"></i> ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº</h3>
                <a href="{{ url_for('mypage_reviews') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                {% if recent_reviews %}
                    {% for review in recent_reviews[:3] %}
                        <div class="review-item mypage-list-item">
                            <div class="review-meta mypage-list-content">
                                <span class="review-date mypage-list-subtitle">{{ review.created_at.strftime('%Y/%m/%d') }}</span>
                                <span class="review-race mypage-list-title">{{ review.race.name }}</span>
                            </div>
                            <p class="review-text">{{ review.content|truncate(100) }}</p>
                            <a href="{{ url_for('review_detail', review_id=review.id) }}" class="mypage-list-action">Ë©≥Á¥∞</a>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content mypage-empty">„É¨„Éì„É•„Éº„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>

        <!-- „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨ -->
        <div class="dashboard-card favorites-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="200">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-horse"></i> „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</h3>
                <a href="{{ url_for('mypage_favorites') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                <div class="favorite-horses-grid mypage-grid">
                    {% if current_user.favorite_horses %}
                        {% for horse in current_user.favorite_horses[:6] %}
                            <div class="horse-item mypage-card">
                                <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="horse-link mypage-card-body">
                                    <div class="horse-icon mypage-list-icon">üêé</div>
                                    <h4 class="mypage-card-title">{{ horse.name }}</h4>
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content mypage-empty">„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈ¶¨„ÅØ„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É°„É¢ -->
        <div class="dashboard-card memos-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="300">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-sticky-note"></i> „É°„É¢</h3>
                <a href="{{ url_for('mypage_memos') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content memo-grid mypage-card-body">
                {% if race_memos or horse_memos %}
                    <!-- „É¨„Éº„Çπ„É°„É¢ -->
                    {% for memo, race in race_memos[:2] %}
                        <div class="memo-item mypage-list-item">
                            <div class="memo-content mypage-list-content">
                                <div class="d-flex justify-content-between">
                                    <h4 class="mypage-list-title">
                                        <i class="fas fa-flag-checkered me-2"></i>
                                        <a href="/races/{{ race.id }}" class="text-decoration-none">{{ race.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ memo.content|truncate(50) }}</p>
                                <span class="memo-date mypage-list-subtitle">{{ memo.created_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}

                    <!-- È¶¨„É°„É¢ -->
                    {% for horse in horse_memos[:2] %}
                        <div class="memo-item mypage-list-item">
                            <div class="memo-content mypage-list-content">
                                <div class="d-flex justify-content-between">
                                    <h4 class="mypage-list-title">
                                        <i class="fas fa-horse me-2"></i>
                                        <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="text-decoration-none">{{ horse.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ horse.memo|truncate(50) }}</p>
                                <span class="memo-date mypage-list-subtitle">{{ horse.updated_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content mypage-empty">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ë®≠ÂÆö„Å∏„ÅÆ„É™„É≥„ÇØ -->
    <a href="{{ url_for('mypage_settings') }}" class="mp-nav-link">
        <i class="fas fa-cog"></i>
        <span>Ë®≠ÂÆö</span>
    </a>
</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
/* „Éû„Ç§„Éö„Éº„Ç∏Â∞ÇÁî®„Çπ„Çø„Ç§„É´ - Êó¢Â≠ò„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊã°Âºµ */
.dashboard-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  background-color: #f8f9fa;
}

.main-visual {
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  padding: 2rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
}

.main-visual::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, #6366F1, #8B5CF6);
}

.profile-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.profile-info {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.profile-image-wrapper {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  overflow: hidden;
  background-color: #6366F1;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
}

.profile-image-placeholder i {
  font-size: 2.5rem;
  color: white;
}

.profile-text h1 {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1E293B;
  margin-bottom: 0.5rem;
}

.premium-badge {
  display: inline-flex;
  align-items: center;
  background: linear-gradient(90deg, #F59E0B, #F97316);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 600;
}

.premium-badge i {
  margin-right: 0.5rem;
}

/* „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„Çπ */
.quick-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background-color: #fff;
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  align-items: center;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s, box-shadow 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  font-size: 1.5rem;
}

.points .stat-icon {
  background-color: #EEF2FF;
  color: #6366F1;
}

.reviews .stat-icon {
  background-color: #FEF3C7;
  color: #F59E0B;
}

.favorites .stat-icon {
  background-color: #FCE7F3;
  color: #EC4899;
}

.stat-content h3 {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1E293B;
  margin: 0;
}

.stat-content p {
  font-size: 0.875rem;
  color: #64748B;
  margin: 0;
}

/* „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.dashboard-card {
  background-color: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s, box-shadow 0.3s;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.dashboard-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.card-header {
  padding: 1.5rem;
  border-bottom: 1px solid #E2E8F0;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-header h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1E293B;
  margin: 0;
  display: flex;
  align-items: center;
}

.card-header h3 i {
  margin-right: 0.75rem;
  color: #6366F1;
}

.view-all {
  color: #6366F1;
  font-size: 0.875rem;
  font-weight: 500;
  text-decoration: none;
  transition: color 0.2s;
}

.view-all:hover {
  color: #4F46E5;
  text-decoration: underline;
}

.card-content {
  padding: 1.5rem;
  flex: 1;
}

/* ÈÄöÁü•„É™„Çπ„Éà */
.notification-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.notification-item {
  display: flex;
  align-items: flex-start;
  padding: 1rem;
  border-radius: 8px;
  background-color: #F8FAFC;
  transition: background-color 0.2s;
}

.notification-item:hover {
  background-color: #F1F5F9;
}

.notification-item.unread {
  background-color: #EEF2FF;
}

.notification-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #E0E7FF;
  color: #6366F1;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  flex-shrink: 0;
}

.notification-content {
  flex: 1;
}

.notification-text {
  margin: 0 0 0.5rem;
  color: #1E293B;
}

.notification-time {
  font-size: 0.75rem;
  color: #64748B;
}

/* „É¨„Éì„É•„Éº„Ç¢„Ç§„ÉÜ„É† */
.review-item {
  padding: 1rem;
  border-radius: 8px;
  background-color: #F8FAFC;
  margin-bottom: 1rem;
}

.review-item:last-child {
  margin-bottom: 0;
}

.review-meta {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.review-date {
  font-size: 0.75rem;
  color: #64748B;
}

.review-race {
  font-weight: 600;
  color: #1E293B;
}

.review-text {
  margin: 0;
  color: #334155;
  font-size: 0.875rem;
}

/* „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨„Ç∞„É™„ÉÉ„Éâ */
.favorite-horses-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 1rem;
}

.horse-item {
  text-align: center;
}

.horse-link {
  display: block;
  padding: 1rem;
  border-radius: 8px;
  background-color: #F8FAFC;
  text-decoration: none;
  transition: background-color 0.2s, transform 0.2s;
}

.horse-link:hover {
  background-color: #EEF2FF;
  transform: translateY(-3px);
}

.horse-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.horse-item h4 {
  margin: 0;
  font-size: 0.875rem;
  color: #1E293B;
  font-weight: 600;
}

/* „É°„É¢„Ç∞„É™„ÉÉ„Éâ */
.memo-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

.memo-item {
  padding: 1rem;
  border-radius: 8px;
  background-color: #F8FAFC;
}

.memo-content h4 {
  margin: 0 0 0.5rem;
  font-size: 1rem;
  display: flex;
  align-items: center;
}

.memo-content h4 i {
  margin-right: 0.5rem;
  color: #6366F1;
}

.memo-content h4 a {
  color: #1E293B;
  text-decoration: none;
}

.memo-content h4 a:hover {
  color: #6366F1;
}

.memo-content p {
  margin: 0 0 0.5rem;
  font-size: 0.875rem;
  color: #334155;
}

.memo-date {
  font-size: 0.75rem;
  color: #64748B;
}

/* Á©∫„ÅÆÁä∂ÊÖã */
.no-content {
  text-align: center;
  padding: 2rem;
  color: #94A3B8;
  font-size: 0.875rem;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
@media (max-width: 768px) {
  .dashboard-container {
    padding: 1rem;
  }
  
  .profile-info {
    flex-direction: column;
    text-align: center;
  }
  
  .profile-image-wrapper {
    margin: 0 auto 1rem;
  }
  
  .quick-stats {
    grid-template-columns: 1fr;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .favorite-horses-grid {
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  }
}
</style>
{% endblock %}