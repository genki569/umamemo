{% extends "base.html" %}

{% block content %}
<div class="dashboard-container mypage-container">
    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ -->
    <div class="main-visual mypage-header" data-aos="fade-down">
        <div class="profile-banner">
            <div class="profile-info">
                <div class="profile-image-wrapper mypage-avatar">
                    {% if current_user.profile_image %}
                        <img src="{{ current_user.profile_image }}" alt="„Éó„É≠„Éï„Ç£„Éº„É´" class="profile-image">
                    {% else %}
                        <div class="profile-image-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="profile-text mypage-user-info">
                    <h1 class="mypage-username">{{ current_user.username }}</h1>
                    {% if current_user.is_premium %}
                        <div class="premium-badge">
                            <i class="fas fa-crown"></i> Premium Member
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„Çπ -->
    <div class="quick-stats mypage-stats" data-aos="fade-up">
        <div class="stat-card points mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.point_balance }}</h3>
                <p>„Éù„Ç§„É≥„Éà</p>
            </div>
        </div>
        <div class="stat-card reviews mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.reviews.count() }}</h3>
                <p>„É¨„Éì„É•„Éº</p>
            </div>
        </div>
        <div class="stat-card favorites mypage-stat">
            <div class="stat-icon mypage-stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.favorite_horses.count() }}</h3>
                <p>„ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</p>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="dashboard-grid">
        <!-- ÈÄöÁü•„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="dashboard-card notifications-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="50">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-bell"></i> ÈÄöÁü•</h3>
                <a href="{{ url_for('view_all_notifications') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                <div class="notification-list mypage-list" id="dashboard-notifications">
                    {% if notifications %}
                        {% for notification in notifications[:5] %}
                            <div class="notification-item mypage-list-item {% if not notification.read %}unread{% endif %}"
                                 data-id="{{ notification.id }}">
                                <div class="notification-icon mypage-list-icon">
                                    <i class="fas {{ notification.icon_class }}"></i>
                                </div>
                                <div class="notification-content mypage-list-content">
                                    <p class="notification-text mypage-list-title">{{ notification.message }}</p>
                                    <span class="notification-time mypage-list-subtitle">{{ notification.created_at|timeago }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content mypage-empty">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº -->
        <div class="dashboard-card reviews-card mypage-card mypage-section">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-pen"></i> ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº</h3>
                <a href="{{ url_for('mypage_reviews') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                {% if recent_reviews %}
                    {% for review in recent_reviews[:3] %}
                        <div class="review-item mypage-list-item">
                            <div class="review-meta mypage-list-content">
                                <span class="review-date mypage-list-subtitle">{{ review.created_at.strftime('%Y/%m/%d') }}</span>
                                <span class="review-race mypage-list-title">{{ review.race.name }}</span>
                            </div>
                            <p class="review-text">{{ review.content|truncate(100) }}</p>
                            <a href="{{ url_for('review_detail', review_id=review.id) }}" class="mypage-list-action">Ë©≥Á¥∞</a>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content mypage-empty">„É¨„Éì„É•„Éº„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>

        <!-- „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨ -->
        <div class="dashboard-card favorites-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="200">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-horse"></i> „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</h3>
                <a href="{{ url_for('mypage_favorites') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content mypage-card-body">
                <div class="favorite-horses-grid mypage-grid">
                    {% if current_user.favorite_horses %}
                        {% for horse in current_user.favorite_horses[:6] %}
                            <div class="horse-item mypage-card">
                                <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="horse-link mypage-card-body">
                                    <div class="horse-icon mypage-list-icon">üêé</div>
                                    <h4 class="mypage-card-title">{{ horse.name }}</h4>
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content mypage-empty">„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈ¶¨„ÅØ„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É°„É¢ -->
        <div class="dashboard-card memos-card mypage-card mypage-section" data-aos="fade-up" data-aos-delay="300">
            <div class="card-header mypage-card-header mypage-section-header">
                <h3 class="mypage-section-title"><i class="fas fa-sticky-note"></i> „É°„É¢</h3>
                <a href="{{ url_for('mypage_memos') }}" class="view-all mypage-list-action">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content memo-grid mypage-card-body">
                {% if race_memos or horse_memos %}
                    <!-- „É¨„Éº„Çπ„É°„É¢ -->
                    {% for memo, race in race_memos[:2] %}
                        <div class="memo-item mypage-list-item">
                            <div class="memo-content mypage-list-content">
                                <div class="d-flex justify-content-between">
                                    <h4 class="mypage-list-title">
                                        <i class="fas fa-flag-checkered me-2"></i>
                                        <a href="/races/{{ race.id }}" class="text-decoration-none">{{ race.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ memo.content|truncate(50) }}</p>
                                <span class="memo-date mypage-list-subtitle">{{ memo.created_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}

                    <!-- È¶¨„É°„É¢ -->
                    {% for horse in horse_memos[:2] %}
                        <div class="memo-item mypage-list-item">
                            <div class="memo-content mypage-list-content">
                                <div class="d-flex justify-content-between">
                                    <h4 class="mypage-list-title">
                                        <i class="fas fa-horse me-2"></i>
                                        <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="text-decoration-none">{{ horse.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ horse.memo|truncate(50) }}</p>
                                <span class="memo-date mypage-list-subtitle">{{ horse.updated_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content mypage-empty">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
/* „Éû„Ç§„Éö„Éº„Ç∏Â∞ÇÁî®„Çπ„Çø„Ç§„É´ - Êó¢Â≠ò„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÊã°Âºµ */
.mypage-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.mypage-header {
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.mypage-avatar {
  border-radius: 50%;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
}

.mypage-username {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1E293B;
}

.mypage-stats {
  gap: 1.5rem;
}

.mypage-stat {
  border-radius: 0.5rem;
  transition: transform 0.2s, box-shadow 0.2s;
}

.mypage-stat:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
}

.mypage-stat-icon {
  color: #4F46E5;
}

.mypage-section {
  margin-bottom: 2.5rem;
}

.mypage-card {
  border-radius: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
}

.mypage-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.mypage-section-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #1E293B;
  display: flex;
  align-items: center;
}

.mypage-section-title i {
  margin-right: 0.75rem;
  color: #4F46E5;
}

.mypage-list-item {
  border-bottom: 1px solid #F1F5F9;
}

.mypage-list-item:last-child {
  border-bottom: none;
}

.mypage-list-icon {
  background-color: #EEF2FF;
  color: #4F46E5;
}

.mypage-list-title {
  font-weight: 500;
  color: #1E293B;
}

.mypage-list-subtitle {
  font-size: 0.875rem;
  color: #64748B;
}

.mypage-list-action {
  color: #4F46E5;
  font-weight: 500;
  text-decoration: none;
  transition: color 0.2s;
}

.mypage-list-action:hover {
  color: #4338CA;
  text-decoration: underline;
}

.mypage-empty {
  text-align: center;
  color: #94A3B8;
}

.mypage-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
@media (max-width: 768px) {
  .mypage-grid {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}