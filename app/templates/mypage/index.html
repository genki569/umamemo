{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ -->
    <div class="main-visual" data-aos="fade-down">
        <div class="profile-banner">
            <div class="profile-info">
                <div class="profile-image-wrapper">
                    {% if current_user.profile_image %}
                        <img src="{{ current_user.profile_image }}" alt="„Éó„É≠„Éï„Ç£„Éº„É´" class="profile-image">
                    {% else %}
                        <div class="profile-image-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="profile-text">
                    <h1>{{ current_user.username }}</h1>
                    {% if current_user.is_premium %}
                        <div class="premium-badge">
                            <i class="fas fa-crown"></i> Premium Member
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„ÉÜ„Éº„Çø„Çπ -->
    <div class="quick-stats" data-aos="fade-up">
        <div class="stat-card points">
            <div class="stat-icon">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.point_balance }}</h3>
                <p>„Éù„Ç§„É≥„Éà</p>
            </div>
        </div>
        <div class="stat-card reviews">
            <div class="stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.reviews.count() }}</h3>
                <p>„É¨„Éì„É•„Éº</p>
            </div>
        </div>
        <div class="stat-card favorites">
            <div class="stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="stat-content">
                <h3>{{ current_user.favorite_horses.count() }}</h3>
                <p>„ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</p>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="dashboard-grid">
        <!-- ÈÄöÁü•„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="dashboard-card notifications-card" data-aos="fade-up" data-aos-delay="50">
            <div class="card-header">
                <h3><i class="fas fa-bell"></i> ÈÄöÁü•</h3>
                <a href="{{ url_for('view_all_notifications') }}" class="view-all">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content">
                <div class="notification-list" id="dashboard-notifications">
                    {% if notifications %}
                        {% for notification in notifications[:5] %}
                            <div class="notification-item {% if not notification.read %}unread{% endif %}"
                                 data-id="{{ notification.id }}">
                                <div class="notification-icon">
                                    <i class="fas {{ notification.icon_class }}"></i>
                                </div>
                                <div class="notification-content">
                                    <p class="notification-text">{{ notification.message }}</p>
                                    <span class="notification-time">{{ notification.created_at|timeago }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content">Êñ∞„Åó„ÅÑÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº -->
        <div class="dashboard-card reviews-card">
            <div class="card-header">
                <h3><i class="fas fa-pen"></i> ÊúÄËøë„ÅÆ„É¨„Éì„É•„Éº</h3>
                <a href="{{ url_for('mypage_reviews') }}" class="view-all">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content">
                {% if recent_reviews %}
                    {% for review in recent_reviews[:3] %}
                        <div class="review-item">
                            <div class="review-meta">
                                <span class="review-date">{{ review.created_at.strftime('%Y/%m/%d') }}</span>
                                <span class="review-race">{{ review.race.name }}</span>
                            </div>
                            <p class="review-text">{{ review.content|truncate(100) }}</p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content">„É¨„Éì„É•„Éº„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>

        <!-- „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨ -->
        <div class="dashboard-card favorites-card" data-aos="fade-up" data-aos-delay="200">
            <div class="card-header">
                <h3><i class="fas fa-horse"></i> „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈ¶¨</h3>
                <a href="{{ url_for('mypage_favorites') }}" class="view-all">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content">
                <div class="favorite-horses-grid">
                    {% if current_user.favorite_horses %}
                        {% for horse in current_user.favorite_horses[:6] %}
                            <div class="horse-item">
                                <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="horse-link">
                                    <div class="horse-icon">üêé</div>
                                    <h4>{{ horse.name }}</h4>
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content">„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈ¶¨„ÅØ„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ÊúÄËøë„ÅÆ„É°„É¢ -->
        <div class="dashboard-card memos-card" data-aos="fade-up" data-aos-delay="300">
            <div class="card-header">
                <h3><i class="fas fa-sticky-note"></i> „É°„É¢</h3>
                <a href="{{ url_for('mypage_memos') }}" class="view-all">„Åô„Åπ„Å¶Ë¶ã„Çã</a>
            </div>
            <div class="card-content memo-grid">
                {% if race_memos or horse_memos %}
                    <!-- „É¨„Éº„Çπ„É°„É¢ -->
                    {% for memo, race in race_memos[:2] %}
                        <div class="memo-item">
                            <div class="memo-content">
                                <div class="d-flex justify-content-between">
                                    <h4>
                                        <i class="fas fa-flag-checkered me-2"></i>
                                        <a href="/races/{{ race.id }}" class="text-decoration-none">{{ race.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ memo.content|truncate(50) }}</p>
                                <span class="memo-date">{{ memo.created_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}

                    <!-- È¶¨„É°„É¢ -->
                    {% for horse in horse_memos[:2] %}
                        <div class="memo-item">
                            <div class="memo-content">
                                <div class="d-flex justify-content-between">
                                    <h4>
                                        <i class="fas fa-horse me-2"></i>
                                        <a href="{{ url_for('horse_detail', horse_id=horse.id) }}" class="text-decoration-none">{{ horse.name }}</a>
                                    </h4>
                                </div>
                                <p>{{ horse.memo|truncate(50) }}</p>
                                <span class="memo-date">{{ horse.updated_at.strftime('%Y/%m/%d') }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-content">„É°„É¢„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 